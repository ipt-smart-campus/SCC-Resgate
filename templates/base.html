{% set TITLE = "Resgate — Espaços Ocupados" %}
<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ TITLE }}</title>
  <style>
    :root{
      /* Light (day) theme */
      --bg:#f7f9fc; --fg:#0b1220; --card:#ffffff; --line:#d6deea; --chip:#eef2fb; --accent:#2a5bd7;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;margin:0;background:var(--bg);color:var(--fg)}
    header{padding:16px 20px;border-bottom:1px solid var(--line);display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:space-between}
    .left, .right{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    h1{font-size:18px;margin:0}
    main{padding:16px 20px}
    .row{display:flex;gap:12px;align-items:center;justify-content:space-between;background:var(--card);border:1px solid var(--line);border-radius:12px;padding:12px 14px;margin:10px 0}
    .muted{opacity:.85}
    .chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:4px}
    .chip{font-size:12px;border:1px solid var(--accent);border-radius:999px;padding:4px 8px;background:var(--chip)}
    .grid{display:grid;grid-template-columns:1fr;gap:10px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
    button{background:#ffffff;color:var(--fg);border:1px solid var(--accent);border-radius:10px;padding:8px 12px;cursor:pointer}
    button:hover{background:#f1f5ff}
    .busy{color:#d32f2f;font-weight:600}
    /* dialogs */
    dialog{border:1px solid var(--line);border-radius:14px;background:var(--card);color:var(--fg);padding:16px 18px;max-width:560px}
    dialog::backdrop{background:rgba(0,0,0,.35)}
    .dlg-actions{display:flex;justify-content:flex-end;margin-top:12px}
  </style>
  {% block head_extra %}{% endblock %}
</head>
<body>
<header>
  <div class="left">
    <h1>{{ TITLE }}</h1>
    <span id="now" class="chip"></span>
  </div>
  <div class="right">
    <button id="helpBtn">Ajuda</button>
    <button id="aboutBtn">About</button>
    <button id="refreshBtn">Atualizar</button>
    <span id="status" class="muted"></span>
  </div>
</header>

<main>
  {% block content %}{% endblock %}
</main>

<!-- Ajuda -->
<dialog id="helpDlg">
  <h3>Como usar</h3>
  <p>Esta página consulta as localizações do Smart Campus Core (Instituição → Campus → Bloco → Área → Espaço).<br/>
  Para cada Espaço, carrega as marcações da semana e mostra os que estão <strong>ocupados neste momento</strong>.</p>
  <ul>
    <li><strong>Atualizar</strong>: força nova leitura dos dados.</li>
    <li>O cartão de um espaço ocupado indica rapidamente onde fica o Espaço (Instituição, Campus, Bloco, Área, Espaço).</li>
  </ul>
  <div class="dlg-actions"><button onclick="document.getElementById('helpDlg').close()">Fechar</button></div>
</dialog>

<!-- About -->
<dialog id="aboutDlg">
  <h3>About</h3>
  <p>Esta página faz parte de uma demonstração de funcionalidades permitidas pelo projeto Smart Campus Core.</p>
  <div class="dlg-actions"><button onclick="document.getElementById('aboutDlg').close()">Fechar</button></div>
</dialog>

<script src="{{ url_for('static', filename='refresh.js') }}"></script>
<script>
  // relógio + botões de diálogo
  (function(){
    const nowEl = document.getElementById("now");
    function tick(){ nowEl.textContent = "Agora: " + (new Date()).toLocaleString("pt-PT"); }
    tick(); setInterval(tick, 1000);
    document.getElementById("helpBtn").addEventListener("click", ()=>document.getElementById("helpDlg").showModal());
    document.getElementById("aboutBtn").addEventListener("click", ()=>document.getElementById("aboutDlg").showModal());
    document.getElementById("refreshBtn").addEventListener("click", ()=>window.__manualRefresh && window.__manualRefresh());
  })();
</script>
{% block scripts %}{% endblock %}
</body>
</html>
